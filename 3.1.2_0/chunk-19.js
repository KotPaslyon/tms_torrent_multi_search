(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{188:function(e,t,r){"use strict";t.a=e=>{const t={version:2,type:"kit"};t.uid=e.uid,t.icon=e.icon,t.title=e.name,t.desc=e.about;const r=t.search={},s=r.torrentSelector={},a=r.onGetValue={};if(r.searchUrl=e.search_path,e.root_url&&(r.baseUrl=e.root_url),e.auth&&(r.loginUrl=e.auth),e.post&&(r.requestType="POST",r.requestData=e.post),e.encode&&(r.onBeforeRequest=[{name:"encode",type:"cp1251"}]),r.listItemSelector=e.items,e.charset&&(r.requestMimeType="text/html; charset="+e.charset),e.cat_alt&&(e.cat_attr="alt",e.cat_alt=void 0),e.auth_f&&(r.loginFormSelector=e.auth_f),(e.sf||e.sl)&&(r.listItemSplice=[e.sf||0,-(e.sl||0)]),s.title=e.tr_name,s.url={selector:e.tr_link,attr:"href"},e.cat_name&&(s.categoryTitle=e.cat_name,e.cat_attr&&(s.categoryTitle={selector:s.categoryTitle,attr:e.cat_attr}),e.cat_link&&(s.categoryUrl={selector:e.cat_link,attr:"href"})),e.tr_size){s.size=e.tr_size,e.size_attr&&(s.size={selector:s.size,attr:e.size_attr});const t=[];e.size_r&&void 0!==e.size_rp&&t.push({name:"replaceRe",re:e.size_r,text:e.size_rp}),e.s_c&&t.push("convertSize"),t.length&&(a.size=t)}if(e.tr_dl&&(s.downloadUrl={selector:e.tr_dl,attr:"href"}),e.seed&&(s.seed=e.seed,e.seed_r&&(a.seed=[{name:"replaceRe",re:e.seed_r,text:e.seed_rp}])),e.peer&&(s.peer=e.peer,e.peer_r&&(a.peer=[{name:"replaceRe",re:e.peer_r,text:e.peer_rp}])),e.date){s.date=e.date,e.date_attr&&(s.date={selector:s.date,attr:e.date_attr});const t=[];e.t_r&&t.push({name:"replaceRe",re:e.t_r,text:e.t_r_r}),e.t_t_r&&t.push("replaceToday"),e.t_m_r&&t.push("replaceMonth"),void 0!==e.t_f&&"-1"!==e.t_f&&t.push({name:"timeFormat",format:e.t_f}),t.length&&(a.date=t)}return t}},189:function(e,t,r){"use strict";r(87);const s=(e,t)=>{const r={selector:null,pipeline:[]};if(e)return Array.isArray(t)||(t=[]),"string"==typeof e&&(e={selector:e}),r.selector=e.selector,"number"==typeof e.childNodeIndex&&r.pipeline.push({name:"getChild",args:[e.childNodeIndex]}),e.attr?r.pipeline.push({name:"getAttr",args:[e.attr]}):e.prop?r.pipeline.push({name:"getProp",args:[e.prop]}):e.html?(r.pipeline.push({name:"getHtml"}),r.pipeline.push({name:"trim"})):(r.pipeline.push({name:"getText"}),r.pipeline.push({name:"trim"})),t.forEach(e=>{"convertSize"===e?r.pipeline.push({name:"legacySizeFormat"}):"replaceToday"===e?r.pipeline.push({name:"legacyReplaceToday"}):"replaceMonth"===e?r.pipeline.push({name:"legacyReplaceMonth"}):"replaceRe"===e.name?r.pipeline.push({name:"replaceRe",args:[e.re,e.text]}):"timeFormat"===e.name&&r.pipeline.push({name:"legacyParseDate",args:[e.format]})}),r};t.a=e=>{const t={version:3,type:"kit"},r=t.search={};r.url=e.search.searchUrl;const a=e.search.requestType;a&&(r.method=a.toUpperCase());const o=e.search.requestData;o&&("POST"===r.method?r.body=o:r.query=o);const n=e.search.onBeforeRequest;if(Array.isArray(n)&&n.some(e=>{if("encode"===e.name&&"cp1251"===e.type)return r.encoding=e.type,!0}),e.search.requestMimeType){const t=/charset=([^;]+)/.exec(e.search.requestMimeType);t&&(e.search.charset=t[1])}const i=t.auth={},l=e.search.loginUrl;l&&(i.url=l);const c=e.search.loginFormSelector;c&&(i.loginForm={selector:c});const h=t.selectors={};h.row=s(e.search.listItemSelector),t.search.listItemSplice&&(h.skipFromStart=e.search.listItemSplice[0],h.skipFromEnd=-1*e.search.listItemSplice[1]),e.search.onGetValue=e.search.onGetValue||{},h.categoryTitle=s(e.search.torrentSelector.categoryTitle,e.search.onGetValue.categoryTitle),h.categoryUrl=s(e.search.torrentSelector.categoryUrl,e.search.onGetValue.categoryUrl),h.categoryId=s(e.search.torrentSelector.categoryId,e.search.onGetValue.categoryId),h.title=s(e.search.torrentSelector.title,e.search.onGetValue.title),h.url=s(e.search.torrentSelector.url,e.search.onGetValue.url),h.size=s(e.search.torrentSelector.size,e.search.onGetValue.size),h.downloadUrl=s(e.search.torrentSelector.downloadUrl,e.search.onGetValue.downloadUrl),h.seeds=s(e.search.torrentSelector.seed,e.search.onGetValue.seed),h.peers=s(e.search.torrentSelector.peer,e.search.onGetValue.peer),h.date=s(e.search.torrentSelector.date,e.search.onGetValue.date),h.nextPageUrl=s(e.search.nextPageSelector,e.search.onGetValue.nextPageSelector);const d=t.description={};d.icon=e.icon,d.name=e.title,e.desc&&(d.description=e.desc),e.updateUrl&&(d.updateUrl=e.updateUrl),e.downloadUrl&&(d.downloadUrl=e.downloadUrl);const p=e.search.baseUrl;return p&&(d.url=p),d.version=e.tVersion,t}},321:function(e,t,r){"use strict";r(18),r(11),r(62);var s=r(29);const a=r(72);t.a=e=>{"object"!=typeof e&&(e={url:e}),e.type&&(e.method=e.type,delete e.type),e.method||(e.method="GET"),e.method=e.method.toUpperCase(),e.data&&("POST"===e.method?e.body=e.data:e.query=e.data,delete e.data);const t=new s.Headers(e.headers);e.body&&(t.has("Content-Type")||t.set("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),"string"!=typeof e.body&&(/^application\/x-www-form-urlencoded/.test(t.get("Content-Type"))?e.body=a.stringify(e.body):/^application\/json/.test(t.get("Content-Type"))&&(e.body=JSON.stringify(e.body)))),e.query&&("string"!=typeof e.query&&(e.query=a.stringify(e.query)),e.url+=(/\?/.test(e.url)?"&":"?")+e.query,delete e.query);const r=e.json;return delete e.json,e.headers=Array.from(t.entries()).reduce((e,t)=>(e.push(t),e),[]),{options:e,toJson:r}}},418:function(e,t,r){"use strict";r(88),r(113);var s=r(166);const a={getAttr:{in:"node",args:[{name:"Attribute",type:"string"}],out:"string",getMethod:e=>Object(s.a)(s.b,s.e,t=>t.getAttribute(e))},getProp:{in:"node",args:[{name:"Property",type:"string"}],out:"string",getMethod:e=>Object(s.a)(s.b,s.e,t=>t[e])},getText:{in:"node",out:"string",getMethod:()=>Object(s.a)(s.c,s.e,e=>e.textContent)},getHtml:{in:"node",out:"string",getMethod:()=>Object(s.a)(s.b,s.e,e=>e.innerHTML)},getChild:{in:"node",args:[{name:"Index",type:"number"}],out:"node",getMethod:e=>e<0?Object(s.a)(s.c,s.c,t=>t.childNodes[t.childNodes.length+e]):Object(s.a)(s.c,s.c,t=>t.childNodes[e])},trim:{in:"string",out:"string",getMethod:()=>Object(s.a)(s.e,s.e,e=>e.trim())},replace:{in:"string",args:[{name:"Pattern",type:"string"},{name:"ReplaceTo",type:"string"}],out:"string",getMethod:(e,t)=>Object(s.a)(s.e,s.e,r=>r.replace(e,t))},replaceRe:{in:"string",args:[{name:"Pattern",type:"string"},{name:"ReplaceTo",type:"string"}],out:"string",getMethod(e,t){const r=new RegExp(e,"ig");return Object(s.a)(s.e,s.e,e=>e.replace(r,t))}},parseDate:{in:"string",args:[{name:"Format",type:"string"}],out:"number",getMethod:e=>r.e(7).then(r.bind(null,471)).then(t=>{const r=t.parse;return Object(s.a)(s.e,s.d,t=>r(t,e).getTime())})},parseSize:{in:"string",out:"number",getMethod:()=>r.e(8).then(r.t.bind(null,472,7)).then(e=>{const t=(e=>(...t)=>{try{return e(...t)}catch(e){throw"string"==typeof e&&(e=new Error(e)),e}})(e.default);return Object(s.a)(s.e,s.d,e=>t(e))})},toInt:{in:"string",out:"number",getMethod:()=>Object(s.a)(s.e,s.d,e=>parseInt(e,10))},toFloat:{in:"string",out:"number",getMethod:()=>Object(s.a)(s.e,s.d,e=>parseFloat(e))},legacyReplaceToday:{in:"string",out:"string",getMethod:()=>r.e(0).then(r.bind(null,410)).then(e=>{const t=e.todayReplace;return Object(s.a)(s.e,s.e,e=>t(e))})},legacyReplaceMonth:{in:"string",out:"string",getMethod:()=>r.e(0).then(r.bind(null,410)).then(e=>{const t=e.monthReplace;return Object(s.a)(s.e,s.e,e=>t(e))})},legacyParseDate:{in:"string",args:[{name:"Template",type:"select",values:[{key:0,text:"2013-04-31[[[ 07]:03]:27]"},{key:1,text:"31-04-2013[[[ 07]:03]:27]"},{key:2,text:"n day ago"},{key:3,text:"04-31-2013[[[ 07]:03]:27]"},{key:4,text:"2d 1h 0m 0s ago"}]}],out:"number",getMethod:e=>r.e(0).then(r.bind(null,410)).then(t=>{const r=t.dateFormat;return Object(s.a)(s.e,s.d,t=>r(e,t))})},legacySizeFormat:{in:"string",out:"number",getMethod:()=>r.e(0).then(r.bind(null,410)).then(e=>{const t=e.sizeFormat;return Object(s.a)(s.e,s.d,e=>t(e))})}};t.a=a},429:function(e,t,r){"use strict";r.d(t,"a",function(){return o}),r.d(t,"b",function(){return n});var s=r(467),a=r.n(s);const o=(e,t)=>{const r=[];return i(t)?a()(t,e,r):r.push(e.querySelector(t)),r[0]||null},n=(e,t)=>{const r=[];return i(t)?a()(t,e,r):r.push(...e.querySelectorAll(t)),r},i=e=>/[^:]:(not|has|contains|empty|parent|header|first|last|eq|even|odd|lt|gt)|^\s*[~+]/.test(e)},430:function(e,t,r){"use strict";r(343),r(11);t.a=e=>{let t,r,s,a="";for(let o=0,n=e.length;o<n;o++){let n=t=(s=e.charAt(o)).charCodeAt(0);a+=r=t>1039&&t<1104?"%"+(n-=848).toString(16):1025===t?"%"+(n=168).toString(16):1105===t?"%"+(n=184).toString(16):32===t?"%"+(n=32).toString(16):10===t?"%0A":s}return a}},437:function(e,t,r){"use strict";r(18),r(19),r(11),r(113),r(87);var s=r(429),a=r(188),o=r(189),n=r(430),i=r(166),l=r(418);const c=["categoryTitle","title"],h=["categoryId","size","seeds","peers","date"],d=["categoryUrl","url","downloadUrl","nextPageUrl"],p=["categoryTitle","categoryUrl","categoryId","title","url","size","downloadUrl","seeds","peers","date"];class u extends Error{constructor(e){super("Auth required"),this.code="AUTH_REQUIRED",this.url=e}}t.a=class{constructor(){this.code=null}init(e){return this.prepareCode(e).then(e=>{this.code=e})}search(e,t){const r=this.code.search;let s=null;s="cp1251"===r.encoding?Object(n.a)(t):encodeURIComponent(t);const a={method:r.method,url:r.url.replace("%search%",s),originUrl:r.originUrl,query:(r.query||"").replace("%search%",s),body:(r.body||"").replace("%search%",s),charset:r.charset};return this.setHeaders(a),this.request(e,a)}searchNext(e,t){const r=this.code.search,s={method:"GET",url:t,originUrl:r.originUrl,charset:r.charset};return this.setHeaders(s),this.request(e,s)}parseResponse(e,t){const r=e.doc=API_getDoc(t.body,t.url);if(this.code.hooks.onGetDoc&&this.code.hooks.onGetDoc(e,r),this.code.auth&&this.code.auth.loginForm&&Object(s.a)(r,this.code.auth.loginForm.selector))throw new u(this.code.auth.url);const a=Object(s.b)(r,this.code.selectors.row.selector);this.code.selectors.skipFromStart&&a.splice(0,this.code.selectors.skipFromStart),this.code.selectors.skipFromEnd&&a.splice(-1*this.code.selectors.skipFromEnd);const o=[];for(let t,r=0;t=a[r];r++)try{const r=this.parseRow(e,t);o.push(r)}catch(e){console.error("parseRow error",e)}let n=null;if(this.code.selectors.nextPageUrl)try{n=this.matchSelector(e,r,"nextPageUrl",this.code.selectors.nextPageUrl)}catch(e){console.error("nextPageUrl matchSelector error",e)}return{results:o,nextPageUrl:n}}parseRow(e,t){const r={},s=[],a={};for(let o,n=0;o=p[n];n++){const n=this.code.selectors[o];if(n)try{r[o]=this.matchSelector(e,t,o,n,a)}catch(e){s.push({key:o,error:e})}}if(!r.title){const e=new Error("Title is not exists");throw e.result=r,e.errors=s,e}if(!r.url){const e=new Error("Url is not exists");throw e.result=r,e.errors=s,e}return r.categoryId||0===r.categoryId||(r.categoryId=-1),r.date||(r.date=-1),s.length&&console.warn("parseRow warnings",{row:t,result:r,errors:s}),r}matchSelector(e,t,r,a,o={}){let n=o[a.selector];n||(n=o[a.selector]=Object(s.a)(t,a.selector));let l=n;return a.pipelineBuild&&(l=a.pipelineBuild(l)),this.code.hooks.transform[r]&&(l=this.code.hooks.transform[r](e,l,t)),-1!==h.indexOf(r)?l="number"!=typeof l?Object(i.d)(parseInt(Object(i.e)(l),10)):Object(i.d)(l):-1!==d.indexOf(r)?l=API_normalizeUrl(e.response.url,Object(i.e)(l)):-1!==c.indexOf(r)&&(l=Object(i.e)(l)),l}setHeaders(e){let t=null;this.code.search.headers&&(t=JSON.parse(this.code.search.headers)),e.headers=t}request(e,t){return this.code.hooks.onBeforeRequest&&this.code.hooks.onBeforeRequest(e,t),API_request(t).then(t=>(e.response=t,this.code.hooks.onAfterRequest&&this.code.hooks.onAfterRequest(e,t),t))}prepareCode(e){return Promise.resolve().then(()=>{1===e.version&&(e=Object(a.a)(e)),2===e.version&&(e=Object(o.a)(e)),e.hooks||(e.hooks={}),e.hooks.transform||(e.hooks.transform={});const t=Object.keys(e.selectors).map(t=>{const r=e.selectors[t];if(r&&r.pipeline)return this.buildPipeline(r.pipeline).then(e=>{r.pipelineBuild=e})});return Promise.all(t).then(()=>e)})}buildPipeline(e){return Promise.resolve().then(()=>{if(!Array.isArray(e)||!e.length)return null;const t=e.map(e=>{const t=l.a[e.name],r=e.args||[];return t.getMethod(...r)});return Promise.all(t).then(e=>t=>{for(let r,s=0;r=e[s];s++)t=r(t);return t})})}}},528:function(e,t,r){},553:function(e,t,r){"use strict";r.r(t);r(87),r(19),r(11),r(528);var s=r(1),a=r.n(s),o=r(5),n=r.n(o),i=r(82),l=r(330),c=r(17),h=r(3),d=r(188),p=r(189);r(81),r(18);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function m(e,t){if(null==e)return{};var r,s,a=function(e,t){if(null==e)return{};var r,s,a={},o=Object.keys(e);for(s=0;s<o.length;s++)r=o[s],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)r=o[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f,S=class extends a.a.Component{constructor(...e){super(...e),g(this,"input",null),g(this,"refInput",e=>{this.input=e}),g(this,"handleChange",e=>{if("checkbox"===this.props.type)this.props.store.set(this.props.id,this.input.checked);else{let e=this.input.value;"number"===this.props.type&&(e=parseInt(e,10),Number.isFinite(e)||(e=0)),this.props.store.set(this.props.id,e)}})}render(){const e=this.props,t=e.store,r=e.id,s=m(e,["store","id"]);return"checkbox"===s.type?s.defaultChecked=t[this.props.id]:s.defaultValue=t[this.props.id],a.a.createElement("input",u({},s,{"data-id":r,ref:this.refInput,onChange:this.handleChange}))}};function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const v=Object(h.a)("ElementSelector");class y extends a.a.Component{constructor(e){super(e),b(this,"state",{showAddDialog:!1,snapshot:null,inputError:null}),b(this,"input",null),b(this,"refInput",e=>{this.input=e}),b(this,"handleChange",e=>{this.selectorStore.set("selector",this.input.value)}),b(this,"optionalCheckbox",null),b(this,"refOptionalCheckbox",e=>{this.optionalCheckbox=e}),b(this,"handleOptionalChange",e=>{if(this.optionalCheckbox.checked){if(!this.selectorStore){const e=this.state.snapshot&&JSON.parse(this.state.snapshot);this.store.set(this.props.id,e||{selector:this.input.value})}}else this.selectorStore&&(this.state.snapshot=JSON.stringify(this.selectorStore),this.store.set(this.props.id,void 0),this.fireActiveSelect())}),b(this,"handleSelect",e=>{e.preventDefault(),this.setActiveSelector(this),this.frameStore.setSelect(!0,{containerSelector:this.getContainerSelector(),skipFromStart:this.store.skipFromStart,skipFromEnd:this.store.skipFromEnd},this.selectListener,this.handleSelectElement),this.activeSelect=()=>{this.frameStore.setSelect()}}),b(this,"selectListener",e=>{this.input.value=e,this.handleChange()}),b(this,"handleSelectElement",e=>{this.fireActiveSelect(),this.input.value=e,this.handleChange()}),b(this,"handleKeyup",e=>{this.selectorStore&&this.updateResult()}),this.activeSelect=null}componentWillUnmount(){this.setActiveSelector(null),this.fireActiveSelect()}get frameStore(){return this.props.rootStore.codeMaker.frame}get store(){return this.props.store}get selectorStore(){return this.props.store[this.props.id]}get isSelectMode(){return this.frameStore.props.selectListener===this.selectListener}setActiveSelector(e){this.props.setActiveSelector&&this.props.setActiveSelector(e)}fireActiveSelect(){this.activeSelect&&(this.activeSelect(),this.activeSelect=null)}updateResult(){this.setActiveSelector(this),this.state.inputError&&this.setState({inputError:null});const e=this.selectorStore.selector;try{if(!this.props.onResolvePath(e))throw new Error("Node is not found")}catch(t){v("updateResult error",e,t),this.setState({inputError:t.message})}try{this.props.onHighlightPath(e,{containerSelector:this.getContainerSelector(),skipFromStart:this.store.skipFromStart,skipFromEnd:this.store.skipFromEnd,scrollIntoView:!this.isSelectMode})}catch(t){v.error("highlightPath error",e,t)}}getContainerSelector(){return""}render(){const e=this.props,t=e.id,r=e.children,s=e.optional,o=this.props.type,n=!this.selectorStore;let i=null;i=s?a.a.createElement("label",{className:"field-name"},a.a.createElement("input",{ref:this.refOptionalCheckbox,defaultChecked:!n,onChange:this.handleOptionalChange,type:"checkbox","data-id":`${t}-optional`}),a.a.createElement("span",null,this.props.title)):a.a.createElement("label",{className:"field-name"},this.props.title);let l=null;this.selectorStore&&(l=this.selectorStore.selector);let c=[];this.state.inputError&&c.push("error");let h=!1;return this.isSelectMode&&(h=!0),a.a.createElement("div",{className:"field"},i,a.a.createElement("input",{disabled:n,readOnly:h,type:o,defaultValue:l,"data-id":t,ref:this.refInput,onChange:this.handleChange,onKeyUp:this.handleKeyup,className:c.join(" ")}),r,a.a.createElement("input",{disabled:n,onClick:this.handleSelect,type:"button","data-id":`${t}-btn`,value:chrome.i18n.getMessage("kitSelect")}))}}b(y,"propTypes",{id:n.a.string.isRequired,optional:n.a.bool,container:n.a.string,className:n.a.string,title:n.a.string.isRequired,type:n.a.string.isRequired,store:n.a.any.isRequired,rootStore:n.a.object,onResolvePath:n.a.func.isRequired,onHighlightPath:n.a.func.isRequired,setActiveSelector:n.a.func});var E=Object(c.b)("rootStore")(f=Object(c.c)(f=class extends y{})||f)||f,k=(r(343),r(418)),C=r(52),N=r.n(C);function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var O=class extends a.a.Component{constructor(e){super(e),w(this,"select",null),w(this,"refSelect",e=>{this.select=e}),w(this,"args",{}),w(this,"refArg",(e,t)=>{t?this.args[e]=t:delete this.args[e]}),w(this,"handleSubmit",e=>{e.preventDefault();const t=Object.keys(this.args).map(e=>this.args[e].value);this.props.onAdd(this.state.methodName||this.select.value,t)}),w(this,"handleCancel",e=>{e.preventDefault(),this.props.onClose()}),w(this,"handleSelect",e=>{this.setState({methodName:this.select.value})}),w(this,"handleAddArg",e=>{e.preventDefault(),this.setState({clonedInputs:this.state.clonedInputs+1})}),w(this,"handleRemoveArg",e=>{e.preventDefault(),0!==this.state.clonedInputs&&this.setState({clonedInputs:this.state.clonedInputs-1})});const t=Object.keys(k.a)[0]||null;this.state={methodName:t,clonedInputs:0}}render(){const e=this.state.methodName,t=k.a[this.state.methodName],r=Object.keys(k.a).map(e=>a.a.createElement("option",{key:e,value:e},e));let s=null;if(t&&t.args&&(s=t.args.map((e,t)=>{let r=null;return r="select"===e.type?a.a.createElement("select",{ref:this.refArg.bind(this,t)},e.values.map(({key:e,text:t})=>a.a.createElement("option",{key:e,value:e},t))):a.a.createElement("input",{ref:this.refArg.bind(this,t),type:e.type}),a.a.createElement("div",{className:"method-arg",key:t},a.a.createElement("div",{className:"arg-name"},e.name),a.a.createElement("div",{className:"arg-input"},r))}),t.multipleArgs)){const e=t.args[0];for(let t=0;t<this.state.clonedInputs;t++){const t=s.length;s.push(a.a.createElement("div",{className:"method-arg",key:t},a.a.createElement("div",{className:"arg-name"},e.name),a.a.createElement("div",{className:"arg-input"},a.a.createElement("input",{ref:this.refArg.bind(this,t),type:e.type}))))}let r=null;this.state.clonedInputs>0&&(r=a.a.createElement("button",{onClick:this.handleRemoveArg},"Remove argument")),s.push(a.a.createElement("div",{className:"arg-controls"},a.a.createElement("button",{onClick:this.handleAddArg},"Add argument"),r))}return N.a.createPortal(a.a.createElement("div",{className:"method-dialog"},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("div",{className:"method-select-wrapper"},a.a.createElement("select",{className:"method-select",ref:this.refSelect,onChange:this.handleSelect,defaultValue:e},r)),s,a.a.createElement("div",{className:"dialog-footer"},a.a.createElement("button",{className:"dialog-button dialog-button-submit",type:"submit"},"Add"),a.a.createElement("button",{className:"dialog-button",onClick:this.handleCancel},"Cancel")))),document.body)}};function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var j,P,x,R,A,D,T=class extends a.a.Component{constructor(e){super(e),M(this,"args",{}),M(this,"refArg",(e,t)=>{t?this.args[e]=t:delete this.args[e]}),M(this,"handleSubmit",e=>{e.preventDefault();const t=Object.keys(this.args).map(e=>this.args[e].value);this.props.method.setArgs(t),this.props.onClose()}),M(this,"handleCancel",e=>{e.preventDefault(),this.props.onClose()}),M(this,"handleAddArg",e=>{e.preventDefault(),this.setState({clonedInputs:this.state.clonedInputs+1})}),M(this,"handleRemoveArg",e=>{e.preventDefault(),0!==this.state.clonedInputs&&this.setState({clonedInputs:this.state.clonedInputs-1})});const t=e.method,r=k.a[t.name];this.state={clonedInputs:0},r.args&&(this.state.clonedInputs=t.args.length-r.args.length)}render(){const e=this.props.method,t=k.a[e.name];let r=null;if(t&&t.args&&(r=t.args.map((t,r)=>{let s=null;return s="select"===t.type?a.a.createElement("select",{ref:this.refArg.bind(this,r),defaultValue:e.args[r]},t.values.map(({key:e,text:t})=>a.a.createElement("option",{key:e,value:e},t))):a.a.createElement("input",{ref:this.refArg.bind(this,r),type:t.type,defaultValue:e.args[r]}),a.a.createElement("div",{className:"method-arg",key:r},a.a.createElement("div",{className:"arg-name"},t.name),a.a.createElement("div",{className:"arg-input"},s))}),t.multipleArgs)){const s=t.args[0];for(let t=0;t<this.state.clonedInputs;t++){const t=r.length;r.push(a.a.createElement("div",{className:"method-arg",key:t},a.a.createElement("div",{className:"arg-name"},s.name),a.a.createElement("div",{className:"arg-input"},a.a.createElement("input",{ref:this.refArg.bind(this,t),type:s.type,defaultValue:e.args[t]}))))}let o=null;this.state.clonedInputs>0&&(o=a.a.createElement("button",{onClick:this.handleRemoveArg},"Remove argument")),r.push(a.a.createElement("div",{className:"arg-controls"},a.a.createElement("button",{onClick:this.handleAddArg},"Add argument"),o))}return N.a.createPortal(a.a.createElement("div",{className:"method-dialog"},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("div",{className:"method-title"},e.name),r,a.a.createElement("div",{className:"dialog-footer"},a.a.createElement("button",{className:"dialog-button dialog-button-submit",type:"submit"},"Save"),a.a.createElement("button",{className:"dialog-button",onClick:this.handleCancel},"Cancel")))),document.body)}},I=r(329),_=r.n(I);function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const F=r(425),U=Object(h.a)("PipelineSelector");let L=Object(c.b)("rootStore")(j=Object(c.c)((x=P=class extends y{constructor(...e){super(...e),q(this,"state",{showAddDialog:!1,snapshot:null,inputError:null,outputError:null,previewMode:!1}),q(this,"sortable",null),q(this,"refSortable",e=>{e?this.sortable||(this.sortable=new F(e,{group:{name:"methods",pull:!1,put:!1},handle:".move",draggable:".method-wrapper",animation:150,onStart:()=>{e.classList.add("sorting")},onEnd:t=>{e.classList.remove("sorting");const r=t.item,s=r.previousElementSibling,a=r.nextElementSibling,o=r.dataset.index,n=s&&s.dataset.index,i=a&&a.dataset.index;this.selectorStore.moveMethod(o,n,i),this.updateResult()}})):this.sortable&&(this.sortable.destroy(),this.sortable=null)}),q(this,"handleOptionalChange",e=>{if(this.optionalCheckbox.checked){if(!this.selectorStore){const e=this.state.snapshot&&JSON.parse(this.state.snapshot),t=this.store.getDefaultPipeline(this.props.id);this.store.set(this.props.id,e||{selector:this.input.value,pipeline:t})}}else this.selectorStore&&(this.state.snapshot=JSON.stringify(this.selectorStore),this.store.set(this.props.id,void 0),this.fireActiveSelect())}),q(this,"handleShowDialog",e=>{e.preventDefault(),this.setState({showAddDialog:!0})}),q(this,"closeDialog",()=>{this.setState({showAddDialog:!1})}),q(this,"addMethod",(e,t)=>{this.setActiveSelector(this),this.selectorStore.addMethod(e,t),this.closeDialog()}),q(this,"handleChangeMethod",()=>{this.setActiveSelector(this)}),q(this,"handleRemoveMethod",e=>{this.setActiveSelector(this),this.selectorStore.removeMethod(e)}),q(this,"selectListener",e=>{this.input.value=e,this.handleChange()}),q(this,"output",null),q(this,"refOutput",e=>{this.output=e}),q(this,"updateResult",()=>{this.setActiveSelector(this),this.state.inputError&&this.setState({inputError:null});const e=this.selectorStore.selector;let t=null;try{if(!(t=this.props.onResolvePath(e,{containerSelector:this.getContainerSelector(),skipFromStart:this.store.skipFromStart,skipFromEnd:this.store.skipFromEnd})))throw new Error("Node is not found")}catch(t){U("updateResult input error",e,t),this.setState({inputError:t.message})}try{this.props.onHighlightPath(e,{containerSelector:this.getContainerSelector(),skipFromStart:this.store.skipFromStart,skipFromEnd:this.store.skipFromEnd,scrollIntoView:!this.isSelectMode})}catch(t){U.error("highlightPath error",e,t)}let r="";return this.selectorStore.pipeline.reduce((e,t)=>e.then(e=>Promise.resolve().then(()=>k.a[t.name].getMethod(...t.args)).then(t=>r=t(e))),Promise.resolve(t)).then(e=>{if(this.selectorStore.verifyType(e),this.state.previewMode)switch(this.props.previewType){case"date":e=new Date(1e3*e).toString();break;case"size":try{e=_()(e)}catch(t){U.warn("filesize error",e,t),e="n/a"}}return e}).then(e=>{this.output&&(this.output.value=e,this.setState({outputError:null}))},e=>{U("updateResult output error",e),this.output&&(this.output.value=r,this.setState({outputError:e.message}))})}),q(this,"handlePreview",e=>{e.preventDefault(),this.setState({previewMode:!this.state.previewMode},()=>{this.updateResult()})})}getContainerSelector(){let e="";const t=this.props.container;return t&&(e=this.store[t].selector),e}render(){const e=this.props,t=e.id,r=e.optional,s=!this.selectorStore;let o=null;o=r?a.a.createElement("label",{className:"field-name"},a.a.createElement("input",{ref:this.refOptionalCheckbox,defaultChecked:!s,onChange:this.handleOptionalChange,type:"checkbox","data-id":`${t}-optional`}),a.a.createElement("span",null,this.props.title)):a.a.createElement("label",{className:"field-name"},this.props.title);let n=null;if(this.props.preview){const e=["preview-btn"];this.state.previewMode&&e.push("active"),n=a.a.createElement("input",{disabled:s,onClick:this.handlePreview,type:"button",title:chrome.i18n.getMessage("kitPreview"),className:e.join(" ")})}let i=null,l=[];this.selectorStore&&(i=this.selectorStore.selector||"",l=this.selectorStore.pipeline.map((e,t)=>a.a.createElement(z,{key:`${t}_${e.name}`,index:t,method:e,onChange:this.handleChangeMethod,onRemove:this.handleRemoveMethod})));const c=[a.a.createElement("button",{disabled:s,key:"add",onClick:this.handleShowDialog,className:"pipeline-button method-add",title:"Add"},"+")];let h=null;this.state.showAddDialog&&(h=a.a.createElement(O,{onClose:this.closeDialog,onAdd:this.addMethod}));let d=["input"],p=["output"];s||(this.state.inputError&&d.push("error"),this.state.outputError&&p.push("error"));let u=!1;return this.isSelectMode&&(u=!0),a.a.createElement("div",{className:"field pipeline-selector"},a.a.createElement("div",{className:"field-left"},o),a.a.createElement("div",{className:"field-right"},a.a.createElement("div",{className:"select"},a.a.createElement("input",{disabled:s,readOnly:u,type:"text","data-id":t,ref:this.refInput,onChange:this.handleChange,onKeyUp:this.handleKeyup,defaultValue:i,className:d.join(" ")}),a.a.createElement("input",{disabled:s,type:"text","data-id":`${t}-result`,ref:this.refOutput,className:p.join(" "),readOnly:!0}),n,a.a.createElement("input",{disabled:s,onClick:this.handleSelect,type:"button","data-id":`${t}-btn`,value:chrome.i18n.getMessage("kitSelect")})),a.a.createElement("div",{className:"pipeline"},a.a.createElement("div",{ref:this.refSortable,className:"pipeline-sortable"},l),a.a.createElement("div",{className:"controls"},c))),h)}},q(P,"propTypes",{id:n.a.string.isRequired,optional:n.a.bool,container:n.a.string,title:n.a.string.isRequired,store:n.a.any.isRequired,rootStore:n.a.object,onResolvePath:n.a.func.isRequired,onHighlightPath:n.a.func.isRequired,setActiveSelector:n.a.func.isRequired,preview:n.a.bool,previewType:n.a.string}),q(P,"defaultProps",{preview:!1,optional:!1}),j=x))||j)||j,z=Object(c.c)((D=A=class extends a.a.Component{constructor(...e){super(...e),q(this,"state",{showEditDialog:!1}),q(this,"handleShowDialog",e=>{e.preventDefault(),this.setState({showEditDialog:!0})}),q(this,"closeDialog",()=>{this.setState({showEditDialog:!1}),this.props.onChange()}),q(this,"handleRemove",e=>{e.preventDefault(),this.props.onRemove(this.props.method)})}render(){const e=this.props.method,t=k.a[e.name],r=e.args.map((e,t)=>a.a.createElement("div",{className:"method-arg",key:t},e));let s=null;this.state.showEditDialog&&(s=a.a.createElement(T,{method:this.props.method,onClose:this.closeDialog}));let o=null;e.args.length&&(o=a.a.createElement("button",{onClick:this.handleShowDialog,title:"Edit",className:"pipeline-button"},"E"));const n=`color-${t.in}-${t.out}`,i=`color-${t.in}`;return a.a.createElement("div",{"data-index":this.props.index,className:`method-wrapper ${n}`},a.a.createElement("div",{className:`move ${i}`}),a.a.createElement("div",{className:"method"},a.a.createElement("div",{className:"method-name"},e.name),a.a.createElement("div",{className:"method-args"},r)),o,a.a.createElement("button",{onClick:this.handleRemove,title:"Remove",className:"pipeline-button"},"X"),s)}},q(A,"propTypes",{method:n.a.object.isRequired,onChange:n.a.func.isRequired,onRemove:n.a.func.isRequired}),R=D))||R;var V=L,$=r(437),G=r(321),H=(r(62),r(332)),J=r(143);function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Q=r(529),K=Object(h.a)("treeAdapter");class W{constructor(e){let t=this;for(;t=t.__proto__;)if(t.constructor===W){Object.assign(t,Q(e));break}}}class Y extends W{createElement(e,t,r){r.forEach(e=>{Y.denyPropsRe.test(e.name)&&(e.name="deny-"+e.name),"href"===e.name&&/^javascript:/.test(e.value)&&(e.value="deny-"+e.value)});const s=e.toUpperCase();if(-1!==Y.denyTags.indexOf(s)){e=`DENY_${s}`;const t=X(r,"style");t?t.value+=";display: none":r.push({name:"style",value:"display: none"})}let a=null;try{a=document.createElementNS(t,e)}catch(r){if("InvalidCharacterError"!==r.name)throw r;K.warn("createElement error: InvalidCharacterError, replaced",e,"div"),a=document.createElementNS(t,"div")}return r.forEach(e=>{try{return a.setAttribute(e.name,e.value)}catch(t){K.error("setAttribute error",e)}}),"A"===s?a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),K.warn("Event: click blocked")}):"FORM"===s&&a.addEventListener("submit",e=>{e.preventDefault(),e.stopPropagation(),K.warn("Event: click blocked")}),a}}B(Y,"denyPropsRe",/^(on|src$|srcset$|style$)/i),B(Y,"denyTags",["NOSCRIPT","LINK","SCRIPT","IFRAME","STYLE"]);const X=(e,t)=>{let r=null;return e.some(e=>{if(e.name===t)return r=e,!0}),r};var Z=Y;const ee=r(530);var te=(e,t,r)=>{const s=ee.parse(e,{treeAdapter:new Z(r)});if(!s.head.querySelector("base")){const e=s.createElement("base");e.href=t,s.head.appendChild(e)}return s};var re,se,ae,oe,ne,ie,le=(e,t,r={})=>{const s=r.skipClassNames||[],a=[];let o,n=e;for(;(o=n)&&(n=o.parentNode)&&1===n.nodeType&&o!==t;){if(o.id){const e=`#${o.id}`;if(1===t.querySelectorAll(e).length){a.unshift(e);break}}const e=o.tagName,r=e.toLowerCase(),i=Array.from(o.classList).filter(e=>-1===s.indexOf(e)),l=Array.from(n.childNodes).filter(t=>t.tagName===e);if(1===l.length)a.unshift(r);else if(1===l.filter(e=>i.every(t=>e.classList.contains(t))).length){const e=`${r}.${i.join(".")}`;if(a.unshift(e),1===t.querySelectorAll(e).length)break}else{const e=l.indexOf(o);a.unshift(`${r}:eq(${e})`)}}return a.join(" > ")},ce=r(429);function he(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const de=Object(h.a)("CodeMakerFrame");let pe=Object(c.b)("rootStore")(re=Object(c.c)((ae=se=class extends a.a.Component{constructor(e){super(e),he(this,"frameDoc",null),he(this,"doc",null),he(this,"frame",null),he(this,"refFrame",e=>{this.frame=e}),he(this,"reqTracker",{connectRe:/.+/,requests:[],profileOptions:{}}),he(this,"hideSelect",()=>{Array.from(this.frameDoc.querySelectorAll(`.${this.selectClassName}`)).forEach(e=>{e.classList.remove(this.selectClassName)})}),this.frameStore.setState("idle"),this.selectClassName="kit_select"}get frameStore(){return this.props.rootStore.codeMaker.frame}componentDidMount(){this.frameStore.options&&this.requestPage(this.frameStore.options)}componentWillUnmount(){this.abort()}requestPage(e){return this.abort(),this.frameStore.setState("pending"),Promise.resolve().then(()=>Object(H.a)(this.reqTracker,e)).then(e=>{const t=Object(J.a)(e.body,e.url),r=te(e.body,e.url,this.frame.contentDocument),s=document.createElement("style");s.textContent=`\n      .${this.selectClassName} {\n        color:#000 !important;\n        background-color:#FFCC33 !important;\n        cursor:pointer;\n        box-shadow: 0 0 3px red, inset 0 0 3px red !important;\n      }`,r.head?r.head.appendChild(s):r.body?r.body.appendChild(s):r.appendChild(s);const a=this.frame.contentDocument.documentElement.parentNode;for(a.textContent="";a.childNodes.length;)a.removeChild(a.firstChild);for(;r.childNodes.length;)a.appendChild(r.firstChild);return this.doc=t,this.frameDoc=a,this.frameStore.setState("done"),e},e=>{this.frameStore.setState("error"),de.error("requestPage error",e)})}abort(){this.reqTracker.requests.forEach(e=>{e.abort()})}resolvePath(e,t={}){const r=t.doc||this.doc,s=ue(r,t);return Object(ce.a)(s,e)}highlightPath(e,t={}){const r=this.resolvePath(e,Object.assign({},t,{doc:this.frameDoc}));this.hideSelect(),r&&(r.classList.add(this.selectClassName),t.scrollIntoView&&r.scrollIntoView())}render(){let e=null;return"done"===this.frameStore.state&&this.frameStore.selectMode&&(e=a.a.createElement(me,{key:"selectMode",frameDoc:this.frameDoc,selectClassName:this.selectClassName,hideSelect:this.hideSelect})),[a.a.createElement("iframe",{key:"frame",ref:this.refFrame,sandbox:"allow-same-origin allow-scripts"}),e]}},he(se,"propTypes",{rootStore:n.a.object}),re=ae))||re)||re;const ue=(e,t)=>{let r=null;if(t.containerSelector?(r=Object(ce.b)(e,t.containerSelector),t.skipFromStart&&r.splice(0,t.skipFromStart),t.skipFromEnd&&r.splice(-1*t.skipFromEnd),r=r[0]):r=e,!r)throw de.error("Container is not found",t),new Error("Container is not found");return r};let me=Object(c.b)("rootStore")(oe=Object(c.c)((ie=ne=class extends a.a.Component{constructor(...e){super(...e),he(this,"handleClick",e=>{const t=e.target;if(1===t.nodeType){const e=this.getPath(t);this.frameStore.selectHandler(e)}}),he(this,"handleMouseOver",e=>{const t=e.target;if(1===t.nodeType){this.props.hideSelect(),t.classList.add(this.props.selectClassName);const e=this.getPath(t);this.frameStore.selectListener(e)}})}get frameStore(){return this.props.rootStore.codeMaker.frame}componentDidMount(){this.props.frameDoc.addEventListener("mouseover",this.handleMouseOver),this.props.frameDoc.addEventListener("mouseup",this.handleClick)}componentWillUnmount(){this.props.hideSelect(),this.props.frameDoc.removeEventListener("mouseover",this.handleMouseOver),this.props.frameDoc.removeEventListener("mouseup",this.handleClick)}getPath(e){let t=null;const r=this.frameStore.selectOptions;return r&&r.containerSelector?(t=Object(ce.b)(this.props.frameDoc,r.containerSelector),r.skipFromStart&&t.splice(0,r.skipFromStart),r.skipFromEnd&&t.splice(-1*r.skipFromEnd),t=t[0]):t=this.props.frameDoc,t.contains(e)?le(e,t,{skipClassNames:[this.props.selectClassName]}):""}render(){return null}},he(ne,"propTypes",{rootStore:n.a.object,frameDoc:n.a.object,selectClassName:n.a.string,hideSelect:n.a.func}),oe=ie))||oe)||oe;var ge,fe,Se,be,ve,ye,Ee,ke,Ce,Ne,we,Oe,Me,je,Pe,xe,Re,Ae,De=pe,Te=r(190),Ie=r(4),_e=r(327);function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function Fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ue=Object(h.a)("codeMaker");let Le=Object(c.b)("rootStore")(ge=Object(c.c)((Se=fe=class extends a.a.Component{constructor(e){super(e),Fe(this,"pageTitleMap",{search:"kitSearch",selectors:"kitSelectors",auth:"kitLogin",desc:"kitDesc",save:"kitSaveLoad"}),Fe(this,"frame",null),Fe(this,"refFrame",e=>{this.frame=e&&e.wrappedInstance}),Fe(this,"handleResolvePath",(e,t)=>this.frame.resolvePath(e,t)),Fe(this,"handleHighlightPath",(e,t)=>this.frame.highlightPath(e,t)),this.props.rootStore.createCodeMaker()}componentDidMount(){document.title=Object(Te.a)("Code maker"),window.ga&&window.ga("send","pageview",{page:location.href,title:document.title})}get codeMakerStore(){return this.props.rootStore.codeMaker}componentWillUnmount(){this.props.rootStore.destroyCodeMaker()}render(){const e=["search","selectors","auth","desc","save"].map(e=>{const t=[];return this.props.page===e&&t.push("active"),a.a.createElement(i.b,{key:e,className:t.join(" "),to:`/codeMaker/${e}`},chrome.i18n.getMessage(this.pageTitleMap[e]))});let t=null;switch(this.props.page){case"search":t=a.a.createElement(ze,{codeStore:this.codeMakerStore.code});break;case"auth":t=a.a.createElement(Ve,{onResolvePath:this.handleResolvePath,onHighlightPath:this.handleHighlightPath,codeStore:this.codeMakerStore.code});break;case"selectors":t=a.a.createElement($e,{onResolvePath:this.handleResolvePath,onHighlightPath:this.handleHighlightPath,codeStore:this.codeMakerStore.code});break;case"desc":t=a.a.createElement(Ge,{codeStore:this.codeMakerStore.code});break;case"save":t=a.a.createElement(He,{codeMaker:this.codeMakerStore})}let r=null;return this.codeMakerStore.frame.options&&(r=a.a.createElement(De,{ref:this.refFrame,key:`frame_${JSON.stringify(this.codeMakerStore.frame.options)}`})),a.a.createElement("div",{className:"page-ctr page-ctr--code-maker"},a.a.createElement("div",{className:"tools"},a.a.createElement("div",{className:"top-menu",id:"menu"},e),a.a.createElement("div",{className:"body",id:"container"},t),a.a.createElement("div",{className:"status_bar",id:"status_bar"},this.codeMakerStore.frame.path)),r)}},Fe(fe,"propTypes",{rootStore:n.a.object,page:n.a.string}),ge=Se))||ge)||ge,ze=Object(c.b)("rootStore")(be=Object(c.c)((ye=ve=class extends a.a.Component{constructor(...e){super(...e),Fe(this,"handleRequestPage",e=>{e.preventDefault();const t={},r=this.searchQuery.value,s=new Je;return s.code=this.props.codeStore.getSnapshot(),Promise.resolve().then(()=>s.search(t,r)).then(e=>{e._=Date.now(),this.frameStore.setOptions(e)})}),Fe(this,"encoding",null),Fe(this,"refEncoding",e=>{this.encoding=e}),Fe(this,"handleEncodingChange",e=>{this.codeSearchStore.set("encoding",this.encoding.value)}),Fe(this,"searchQuery",null),Fe(this,"refSearchQuery",e=>{this.searchQuery=e}),Fe(this,"handleMethodChange",e=>{this.codeSearchStore.set("method",this.method.value)}),Fe(this,"method",null),Fe(this,"refMethod",e=>{this.method=e})}get frameStore(){return this.props.rootStore.codeMaker.frame}get codeSearchStore(){return this.props.codeStore.search}render(){const e=[];"error"===this.frameStore.state&&e.push("error");let t=null;return("POST"===this.codeSearchStore.method||this.codeSearchStore.body)&&(t=a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitPostBody")),a.a.createElement(S,{store:this.codeSearchStore,id:"body",type:"text",placeholder:"key=value&key2=value2"}))),a.a.createElement("div",{className:"page search"},a.a.createElement("h2",null,chrome.i18n.getMessage("kitSearch")),a.a.createElement("div",{className:"field"},a.a.createElement("form",{onSubmit:this.handleRequestPage},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitSearchUrl")),a.a.createElement(S,{className:e,store:this.codeSearchStore,id:"url",type:"text"}),a.a.createElement("input",{ref:this.refSearchQuery,type:"text",placeholder:"Search query"})," ",a.a.createElement("input",{type:"submit",value:chrome.i18n.getMessage("kitOpen")}))),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitSearchMethod")),a.a.createElement("select",{onChange:this.handleMethodChange,ref:this.refMethod,defaultValue:this.codeSearchStore.method},a.a.createElement("option",{value:"GET"},"GET"),a.a.createElement("option",{value:"POST"},"POST"))),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitQuery")),a.a.createElement(S,{store:this.codeSearchStore,id:"query",type:"text"})),t,a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitSearchQueryEncoding")),a.a.createElement("select",{onChange:this.handleEncodingChange,ref:this.refEncoding,defaultValue:this.codeSearchStore.encoding},a.a.createElement("option",{value:""},"utf-8"),a.a.createElement("option",{value:"cp1251"},"cp1251"))),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitPageCharset")),a.a.createElement(S,{store:this.codeSearchStore,id:"charset",type:"text",placeholder:"auto"})))}},Fe(ve,"propTypes",{rootStore:n.a.object,codeStore:n.a.object}),be=ye))||be)||be,Ve=Object(c.b)("rootStore")(Ee=Object(c.c)((Ce=ke=class extends a.a.Component{constructor(...e){super(...e),Fe(this,"handleSubmit",e=>{e.preventDefault();const t=new Je;t.code=this.props.codeStore.getSnapshot();const r={method:"GET",url:t.code.auth.url};r._=Date.now(),this.frameStore.setOptions(r)})}get frameStore(){return this.props.rootStore.codeMaker.frame}get codeSearchAuth(){return this.props.codeStore.auth}render(){const e=[];return"error"===this.frameStore.state&&e.push("error"),a.a.createElement("div",{className:"page auth"},a.a.createElement("h2",null,chrome.i18n.getMessage("kitLogin")),a.a.createElement("div",{className:"field"},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitLoginUrl")),a.a.createElement(S,{className:e.join(" "),store:this.codeSearchAuth,id:"url",type:"text"}),a.a.createElement("input",{type:"submit","data-id":"auth_open",value:chrome.i18n.getMessage("kitOpen")}))),a.a.createElement(E,{store:this.codeSearchAuth,onResolvePath:this.props.onResolvePath,onHighlightPath:this.props.onHighlightPath,id:"loginForm",optional:!0,type:"text",title:chrome.i18n.getMessage("kitLoginFormSelector")}))}},Fe(ke,"propTypes",{rootStore:n.a.object,codeStore:n.a.object.isRequired,onResolvePath:n.a.func.isRequired,onHighlightPath:n.a.func.isRequired}),Ee=Ce))||Ee)||Ee,$e=Object(c.b)("rootStore")(Ne=Object(c.c)((Oe=we=class extends a.a.Component{constructor(...e){super(...e),Fe(this,"outputAutorun",null),Fe(this,"activeSelector",null),Fe(this,"setActiveSelector",e=>{this.activeSelector!==e&&(this.outputAutorun&&(this.outputAutorun(),this.outputAutorun=null),this.activeSelector=e,this.activeSelector&&(this.outputAutorun=Object(Ie.autorun)(()=>{this.activeSelector&&JSON.stringify(this.activeSelector.selectorStore)&&this.activeSelector.updateResult()})))})}get codeSearchSelectors(){return this.props.codeStore.selectors}componentWillUnmount(){this.outputAutorun&&(this.outputAutorun(),this.outputAutorun=null)}render(){const e={store:this.codeSearchSelectors,onResolvePath:this.props.onResolvePath,onHighlightPath:this.props.onHighlightPath,setActiveSelector:this.setActiveSelector};return a.a.createElement("div",{className:"page selectors"},a.a.createElement("h2",null,chrome.i18n.getMessage("kitSelectors")),a.a.createElement(E,qe({},e,{id:"row",type:"text",className:"input",title:chrome.i18n.getMessage("kitRowSelector")})),a.a.createElement("div",{className:"field skip-field"},a.a.createElement("div",{className:"field-left"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitSkip"))),a.a.createElement("div",{className:"field-right"},a.a.createElement("span",null,chrome.i18n.getMessage("kitSkipTop"))," ",a.a.createElement(S,{store:this.codeSearchSelectors,id:"skipFromStart",type:"number"})," ",a.a.createElement("span",null,chrome.i18n.getMessage("kitSkipEnd"))," ",a.a.createElement(S,{store:this.codeSearchSelectors,id:"skipFromEnd",type:"number"}))),a.a.createElement(V,qe({},e,{id:"categoryTitle",optional:!0,container:"row",title:chrome.i18n.getMessage("kitCategoryName")})),a.a.createElement(V,qe({},e,{id:"categoryUrl",optional:!0,container:"row",title:chrome.i18n.getMessage("kitCategoryLink")})),a.a.createElement(V,qe({},e,{id:"title",container:"row",title:chrome.i18n.getMessage("kitTorrentTitle")})),a.a.createElement(V,qe({},e,{id:"url",container:"row",title:chrome.i18n.getMessage("kitTorrentLink")})),a.a.createElement(V,qe({},e,{id:"size",optional:!0,container:"row",preview:!0,previewType:"size",title:chrome.i18n.getMessage("kitTorrentSize")})),a.a.createElement(V,qe({},e,{id:"downloadUrl",optional:!0,container:"row",title:chrome.i18n.getMessage("kitTorrentDownloadLink")})),a.a.createElement(V,qe({},e,{id:"seeds",optional:!0,container:"row",title:chrome.i18n.getMessage("kitSeedCount")})),a.a.createElement(V,qe({},e,{id:"peers",optional:!0,container:"row",title:chrome.i18n.getMessage("kitPeerCount")})),a.a.createElement(V,qe({},e,{id:"date",optional:!0,container:"row",preview:!0,previewType:"date",title:chrome.i18n.getMessage("kitAddTime")})),a.a.createElement(V,qe({},e,{id:"nextPageUrl",optional:!0,title:chrome.i18n.getMessage("kitNextPageLink")})))}},Fe(we,"propTypes",{rootStore:n.a.object,codeStore:n.a.object.isRequired,onResolvePath:n.a.func.isRequired,onHighlightPath:n.a.func.isRequired}),Ne=Oe))||Ne)||Ne,Ge=Object(c.b)("rootStore")(Me=Object(c.c)((Pe=je=class extends a.a.Component{constructor(...e){super(...e),Fe(this,"handleIconClick",e=>{e.preventDefault(),this.codeStoreDescription.set("icon",Object(l.a)())}),Fe(this,"iconData",null),Fe(this,"iconDataInput",e=>{this.iconData=e}),Fe(this,"handleIconDataChange",e=>{this.codeStoreDescription.set("icon",this.iconData.value)}),Fe(this,"handleIconFileChange",e=>{const t=this.iconFile.files,r=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=e=>{t(s.result)},s.onerror=e=>{r(new Error("Read file error"))},s.readAsDataURL(e)}).then(e=>{this.codeStoreDescription.set("icon",e)}).catch(t=>{Ue.error("readFile error",e.name,t)}),s=/^image\/(x-icon|jpeg|png|svg)$/;for(let e,a=0;e=t[a];a++)try{if(!s.test(e.type))throw new Error("Incorrect file type");if(e.size>1048576)throw new Error("File size more then 1mb");r(e)}catch(t){Ue("Skip file cause: ",e.name,t)}}),Fe(this,"iconFile",null),Fe(this,"iconFileInput",e=>{this.iconFile=e})}get codeStoreDescription(){return this.props.codeStore.description}generateIcon(e){return Object(_e.a)(e)}render(){const e=this.props.codeStore;return a.a.createElement("div",{className:"page desk"},a.a.createElement("h2",null,chrome.i18n.getMessage("kitDesc")),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitIcon")),a.a.createElement("i",{onClick:this.handleIconClick,style:{backgroundImage:`url(${this.generateIcon(e.description.icon)})`},className:"tracker_iconPic","data-id":"desk_tracker_iconPic"})," ",a.a.createElement("input",{ref:this.iconDataInput,onChange:this.handleIconDataChange,"data-id":"desk_tracker_icon",value:e.description.icon}),a.a.createElement("input",{ref:this.iconFileInput,onChange:this.handleIconFileChange,type:"file","data-id":"desk_tracker_iconFile"})),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitTrackerTitle")),a.a.createElement(S,{store:this.codeStoreDescription,id:"name",type:"text"})),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitTrackerUrl")),a.a.createElement(S,{store:this.codeStoreDescription,id:"url",type:"text",placeholder:"auto"})),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitTrackerDesc")),a.a.createElement(S,{store:this.codeStoreDescription,id:"description",type:"text"})),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitTrackerUpdateUrl")),a.a.createElement(S,{store:this.codeStoreDescription,id:"updateUrl",type:"text"})),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitTrackerIsDownloadUrl")),a.a.createElement(S,{store:this.codeStoreDescription,id:"downloadUrl",type:"text"})),a.a.createElement("div",{className:"field"},a.a.createElement("span",{className:"field-name"},chrome.i18n.getMessage("kitTrackerVersion")),a.a.createElement(S,{store:this.codeStoreDescription,id:"version",type:"text",placeholder:"1.0"})))}},Fe(je,"propTypes",{rootStore:n.a.object,codeStore:n.a.object.isRequired}),Me=Pe))||Me)||Me,He=Object(c.b)("rootStore")(xe=Object(c.c)((Ae=Re=class extends a.a.Component{constructor(...e){super(...e),Fe(this,"handleSetCode",e=>{e.preventDefault();let t=JSON.parse(this.textarea.value);1===t.version&&(t=Object(d.a)(t)),2===t.version&&(t=Object(p.a)(t)),t.description||(t.description={}),t.description.icon||(t.description.icon=Object(l.a)()),t.description.name||(t.description.name=""),t.description.version||(t.description.version="1.0"),this.props.codeMaker.setCode(t)}),Fe(this,"handleGetCode",e=>{e.preventDefault(),this.textarea.value=this.props.codeMaker.codeJson}),Fe(this,"textarea",null),Fe(this,"refTextarea",e=>{this.textarea=e})}render(){return a.a.createElement("div",{className:"page save"},a.a.createElement("h2",null,chrome.i18n.getMessage("kitSaveLoad")),a.a.createElement("div",null,a.a.createElement("input",{onClick:this.handleGetCode,type:"button",value:chrome.i18n.getMessage("kitGetCode")}),a.a.createElement("input",{onClick:this.handleSetCode,type:"button",value:chrome.i18n.getMessage("kitReadCode")})),a.a.createElement("label",null,a.a.createElement("textarea",{ref:this.refTextarea,"data-id":"save_code_textarea",defaultValue:this.props.codeMaker.codeJson})))}},Fe(Re,"propTypes",{rootStore:n.a.object,codeMaker:n.a.object}),xe=Ae))||xe)||xe;class Je extends $.a{request(e,t){return Object(G.a)(t).options}}t.default=Le}}]);